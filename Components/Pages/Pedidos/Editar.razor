@page "/Pedidos/Editar/{id:int}"
@using Big.Models
@using Big.Services
@inject PedidoService PedidoService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<h3>Editar Pedido</h3>

@if (pedido == null)
{
    <p>Carregando pedido...</p>
}
else
{
    <EditForm Model="@pedido" OnValidSubmit="AtualizarPedidoAsync">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label class="form-label">Cliente:</label>
            <InputText class="form-control" @bind-Value="pedido.Cliente.Nome" Disabled="true" />
        </div>

        <div class="mb-3">
            <label class="form-label">Data do Pedido:</label>
            <InputDate class="form-control" @bind-Value="pedido.DataPedido" Disabled="true" />
        </div>

        <div class="mb-3">
            <label class="form-label">Status:</label>
            <InputSelect class="form-control" @bind-Value="pedido.Status">
                <option value="Aguardando">Aguardando</option>
                <option value="Aprovado">Aprovado</option>
                <option value="Rejeitado">Rejeitado</option>
            </InputSelect>
        </div>

        <div class="mb-3">
            <label class="form-label">Total:</label>
            <InputNumber class="form-control" @bind-Value="pedido.Total" />
        </div>

        <button type="submit" class="btn btn-success">Salvar</button>
        <a href="/Pedidos" class="btn btn-secondary">Cancelar</a>
    </EditForm>
}

@code {
    [Parameter] public int id { get; set; }
    private Pedido? pedido;

    protected override async Task OnInitializedAsync()
    {
        pedido = await PedidoService.ObterPorIdAsync(id);

        // Garante que o pedido não seja nulo e cria um novo objeto se necessário
        if (pedido == null)
        {
            pedido = new Pedido();
        }
    }

    private async Task AtualizarPedidoAsync()
    {
        if (pedido != null)
        {
            await PedidoService.AtualizarAsync(pedido);
            Navigation.NavigateTo("/Pedidos");
        }
    }
}
